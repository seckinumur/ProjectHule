@model DAL.VM.VMStok
@{
    ViewBag.Title = "Choice Admin Control Systems V.1.5 / Stok işlemleri";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="page-wrapper">
    <div class="row">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Stok İşlemleri</h1>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">

                <div class="col-lg-12">

                    <div class="form-group col-sm-2">
                        <label>Marka</label>
                        <select class="selectpicker form-control" data-live-search="true" name="Marka" id="marka" data-style="btn-primary">
                            @{
                                foreach (var item in Model.Markalar)
                                {
                                    <option data-tokens="@item.Marka">@item.Marka</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="form-group col-sm-2">
                        <label>Model</label>
                        <select class="selectpicker form-control" data-live-search="true" name="Model" id="model" data-style="btn-info">
                            @{
                                foreach (var item in Model.Modeller)
                                {
                                    <option data-tokens="@item.Model">@item.Model</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="form-group col-sm-2">
                        <label>Sınıf Kodu</label>
                        <select class="selectpicker form-control" id="SK" title="Sınıf Kodu" data-style="btn-warning"></select>
                    </div>

                    <div class="form-group col-sm-2">
                        <label>Sınıf Tanımı</label>
                        <select class="selectpicker form-control" id="ST" title="Sınıf Tanımı" name="ST" data-style="btn-danger"></select>
                    </div>

                    <div class="form-group col-sm-2">
                        <label>Detaylı Ara</label>
                        <button class="btn btn-warning col-md-12 form-control" data-toggle="collapse" data-target="#Detay" onclick="Arama()" aria-expanded="false" aria-controls="collapseExample">Detay</button>
                    </div>

                    <div class="form-group col-sm-2">
                        <label>Ürünü Bul</label>
                        <input hidden="hidden" value="0" id="DetayKontrol" />
                        <button onclick="BUL()" class="btn btn-success col-md-12 form-control">Bul</button>
                    </div>

                </div>
                <div class="col-lg-12 collapse" id="Detay">
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            Detaylı Arama
                        </div>
                        <div class="panel-body">
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 1</label>
                                <select class="selectpicker form-control" id="S1" title="Section 1"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 2</label>
                                <select class="selectpicker form-control" id="S2" title="Section 2"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 3</label>
                                <select class="selectpicker form-control" id="S3" title="Section 3"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 4</label>
                                <select class="selectpicker form-control" id="S4" title="Section 4"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 5</label>
                                <select class="selectpicker form-control" id="S5" title="Section 5"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 6</label>
                                <select class="selectpicker form-control" id="S6" title="Section 6"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 7</label>
                                <select class="selectpicker form-control" id="S7" title="Section 7"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 8</label>
                                <select class="selectpicker form-control" id="S8" title="Section 8"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 9</label>
                                <select class="selectpicker form-control" id="S9" title="Section 9"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 10</label>
                                <select class="selectpicker form-control" id="S10" title="Section 10"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 11</label>
                                <select class="selectpicker form-control" id="S11" title="Section 11"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 12</label>
                                <select class="selectpicker form-control" id="S12" title="Section 12"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 13</label>
                                <select class="selectpicker form-control" id="S13" title="Section 13"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 14</label>
                                <select class="selectpicker form-control" id="S14" title="Section 14"></select>
                            </div>
                            <div class="form-group col-sm-2">
                                <label class="text-danger">Section 15</label>
                                <select class="selectpicker form-control" id="S15" title="Section 15"></select>
                            </div>
                        </div>
                    </div>
                </div>

                <br />

            </div>
            <div class="col-lg-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        Arama Sonucu Listeleniyor. İlgili Ürünle Detay Görmek ve işlem Yapmak İçin Tıklayınız.
                    </div>
                    <div class="panel-body">
                        <table id="Tablo" class="table table-striped table-bordered table-hover" width="100%">
                            <thead>
                                <tr>
                                    <th>Marka</th>
                                    <th>Model</th>
                                    <th>Sınıf Kodu</th>
                                    <th>Sınıf Tanımı</th>
                                    <th>Malzeme Kodu</th>
                                    <th>Adet</th>
                                    <th>Fiyat</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <br />
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="panel panel-success">
                    <div class="panel-body">
                        <form method="post" enctype="multipart/form-data">
                            <div class="col-xs-4">
                                <input class="btn btn-default" type="file" name="Dosya" />
                            </div>
                            <div class="col-xs-6">
                                <p class="@ViewBag.Class">@ViewBag.Text</p>
                            </div>
                            <div class="col-xs-2">
                                <button type="submit" class="btn btn-success btn-block">Yükle</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="Bak" tabindex="-1" role="dialog" aria-labelledby="DuzenleLabel" aria-hidden="true" style="display: none;">
    <div class="modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="DuzenleLabel">Ürün Stok</h4>
            </div>
            <div class="modal-body">
                <div class="form-group col-md-4">
                    <label>Marka Adı</label>
                    <input class="form-control" id="marka1" readonly="readonly">
                </div>
                <div class="form-group col-md-4">
                    <label>Model Adı</label>
                    <input class="form-control" id="model1" readonly="readonly">
                </div>
                <div class="form-group col-md-4">
                    <label>Sınıf Kodu</label>
                    <input class="form-control" id="SinifKodu1" readonly="readonly">
                </div>
                <div class="form-group col-md-4">
                    <label>Sınıf Tanımı</label>
                    <input class="form-control" id="SinifTanimi1" readonly="readonly">
                </div>
                <div class="form-group col-md-2">
                    <label>Malzeme Kodu</label>
                    <input class="form-control" id="malzemekodu1" readonly="readonly">
                </div>
                <div class="form-group col-md-2">
                    <label>Ürün Fiyatı</label>
                    <input type="number" class="form-control" id="Fiyat" min="0.00" required>
                </div>
                <div class="form-group col-md-2">
                    <label>Stok Adedi</label>
                    <input type="number" class="form-control" id="Stok" min="0" required>
                </div>
                <div class="form-group col-md-2">
                    <label>Güncelle</label>
                    <button class="btn btn-success form-control" onclick="StokGuncelle()"><i class="fa fa-check"> Kaydet</i></button>
                </div>
                <div class="form-group">
                    <iframe class="col-xs-12" frameborder="0" style="height:500px" id="Bura"></iframe>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">
    function Arama() {
        var anahtar = document.getElementById("DetayKontrol").value;
        if (anahtar == 0) {
            document.getElementById("DetayKontrol").value = 1;
        }
        else {
            document.getElementById("DetayKontrol").value = 0;
        }
    };
    function BUL() {

        var Marka = $('#marka').selectpicker('val');
        var Model = $('#model').selectpicker('val');
        var SinifKodu = $('#SK').selectpicker().find("option:selected").text();
        var SinifTanimi = $('#ST').selectpicker().find("option:selected").text();
        var detay = document.getElementById("DetayKontrol").value;

        if (detay == 0) {
            var Veri = JSON.stringify({
                'Marka': Marka,
                'Model': Model,
                'SinifKodu': SinifKodu,
                'SinifTanimi': SinifTanimi,
                'Detay': detay
            });
        }
        else {
            var Veri = JSON.stringify({
                'Marka': Marka,
                'Model': Model,
                'SinifKodu': SinifKodu,
                'SinifTanimi': SinifTanimi,
                'Detay': detay,
                'Section1': $('#S1').selectpicker().find("option:selected").text(),
                'Section2': $('#S2').selectpicker().find("option:selected").text(),
                'Section3': $('#S3').selectpicker().find("option:selected").text(),
                'Section4': $('#S4').selectpicker().find("option:selected").text(),
                'Section5': $('#S5').selectpicker().find("option:selected").text(),
                'Section6': $('#S6').selectpicker().find("option:selected").text(),
                'Section7': $('#S7').selectpicker().find("option:selected").text(),
                'Section8': $('#S8').selectpicker().find("option:selected").text(),
                'Section9': $('#S9').selectpicker().find("option:selected").text(),
                'Section10': $('#S10').selectpicker().find("option:selected").text(),
                'Section11': $('#S11').selectpicker().find("option:selected").text(),
                'Section12': $('#S12').selectpicker().find("option:selected").text(),
                'Section13': $('#S13').selectpicker().find("option:selected").text(),
                'Section14': $('#S14').selectpicker().find("option:selected").text(),
                'Section15': $('#S15').selectpicker().find("option:selected").text()
            });
        };

        $.ajax({
            type: 'POST',
            url: '/Admin/UrunBul/',
            data: Veri,
            contentType: 'application/json',
            success: function (data) {
                var table = $('#Tablo').DataTable({
                    data: data,
                    columns: [
                        { data: 'Marka' },
                        { data: 'Model' },
                        { data: 'SinifKodu' },
                        { data: 'SinifTanimi' },
                        { data: 'MalzemeKodu' },
                        { data: 'Stok' },
                        { data: 'Fiyat' }
                    ],
                    select: true,
                    lengthChange: false,
                    dom: 'Bfrtip',
                    buttons: ['copy', 'excel', 'pdf', 'print'],
                    responsive: true,
                    destroy: true
                });
                table
                    .on('select', function (e, dt, type, indexes) {
                        var rowData = table.rows({ selected: true }).data();
                        document.getElementById("marka1").value = rowData[0].Marka;
                        document.getElementById("model1").value = rowData[0].Model;
                        document.getElementById("malzemekodu1").value = rowData[0].MalzemeKodu;
                        document.getElementById("SinifKodu1").value = rowData[0].SinifKodu;
                        document.getElementById("SinifTanimi1").value = rowData[0].SinifTanimi;
                        document.getElementById("Stok").value = rowData[0].Stok;
                        document.getElementById("Fiyat").value = rowData[0].Fiyat;
                        document.getElementById("Bura").src = "http://sapservices.boydak.net/fabric/material/" + rowData[0].MalzemeKodu;
                        $('#Bak').modal('show');
                    });
            },
        });
    };
    function StokGuncelle() {

        var adet = JSON.stringify({
            'Stok': document.getElementById("Stok").value,
            'Fiyati': document.getElementById("Fiyat").value,
            'malzemekodu': document.getElementById("malzemekodu1").value
        });

        $.ajax({
            type: 'POST',
            url: '/Admin/StokEkle/',
            data: adet,
            contentType: 'application/json',
            success: function (response) {
                if (response != null && response.success) {
                    $('#Bak').modal('hide');
                    BUL();
                    $.notify({
                        icon: 'fa fa-check-circle',
                        message: response.responseText,
                    }, {
                            type: 'success',
                            placement: {
                                from: 'top',
                                align: 'center'
                            },
                            delay: 1500
                        });
                } else {
                    $.notify({
                        icon: 'fa fa-exclamation-triangle',
                        message: response.responseText,
                    }, {
                            type: 'danger',
                            placement: {
                                from: 'top',
                                align: 'center'
                            },
                            delay: 1500
                        });
                }
            }
        });
    };
</script>
